# Partial Exits –∏ Trailing Stop - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–î–∞—Ç–∞**: 2026-02-12  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

---

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **Partial Exits (Scale-Out)** ‚úÖ

**–¢–ó 7.2**: "–ß–∞—Å—Ç–∏—á–Ω—ã–µ —Ç–µ–π–∫–∏ (scale-out)"

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –ø—Ä–∏–±—ã–ª–∏ (–≤ R-–º–Ω–æ–∂–∏—Ç–µ–ª—è—Ö)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —É—Ä–æ–≤–Ω–∏ —á–µ—Ä–µ–∑ `config.yaml`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 50% –Ω–∞ 2R, 25% –Ω–∞ 3R

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

**–§–∞–π–ª**: `execution/position_manager.py`

**–ú–µ—Ç–æ–¥**: `_check_partial_exits()`

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø—Ä–∏–±—ã–ª—å –≤ R-–º–Ω–æ–∂–∏—Ç–µ–ª—è—Ö (R = risk distance)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
3. –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —É—Ä–æ–≤–Ω—è —Å–æ–∑–¥–∞—ë—Ç Market –æ—Ä–¥–µ—Ä –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏
4. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Å—Ç–∏—á–Ω–æ–º –≤—ã—Ö–æ–¥–µ
5. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ —Ç–æ–≥–æ –∂–µ —É—Ä–æ–≤–Ω—è

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤**:
```
üéØ Partial exit triggered for BTCUSDT: R=2.15 >= 2.0R, closing 50% (0.005000)
‚úì Partial exit executed: 0.005000 @ 45250.00, remaining size: 0.005000
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config.yaml):

```yaml
position_management:
  partial_exits:
    enabled: true
    levels:
      - r_level: 2.0      # –ü—Ä–∏ 2R (—É–¥–≤–æ–µ–Ω–∏–µ —Ä–∏—Å–∫–∞)
        percent: 0.50     # –ó–∞–∫—Ä—ã—Ç—å 50%
      - r_level: 3.0      # –ü—Ä–∏ 3R
        percent: 0.25     # –ó–∞–∫—Ä—ã—Ç—å –µ—â—ë 25% (–æ—Å—Ç–∞–Ω–µ—Ç—Å—è 25%)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –§–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏ –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏
- ‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞ —Ä–æ—Å—Ç–∞
- ‚úÖ –ü–æ–ª–Ω–∞—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —É—Ä–æ–≤–Ω–µ–π)

---

### 2. **Trailing Stop —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∏—Ä–∂–µ–π** ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: Trailing Stop —Ä–∞–±–æ—Ç–∞–ª —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ), –Ω–µ –æ–±–Ω–æ–≤–ª—è—è —Ä–µ–∞–ª—å–Ω—ã–π SL –Ω–∞ –±–∏—Ä–∂–µ.

#### –†–µ—à–µ–Ω–∏–µ:

**–§–∞–π–ª**: `execution/position_manager.py`

**–ú–µ—Ç–æ–¥**: `_update_stop_on_exchange()`

**–ê–ª–≥–æ—Ä–∏—Ç–º**:
1. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Trailing Stop –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `_update_stop_on_exchange()`
2. –ú–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Bybit Trading Stop API `/v5/position/trading-stop`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π SL –Ω–∞ –±–∏—Ä–∂–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
4. –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ (fallback)

**–ö–æ—Ä—Ä–µ–∫—Ü–∏–∏ –≤ –º–µ—Ç–æ–¥–∞—Ö**:

- `_check_trailing()`: –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `_update_stop_on_exchange()` –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è trailing stop
- `_check_breakeven()`: –£–∂–µ –æ–±–Ω–æ–≤–ª—è–ª SL –Ω–∞ –±–∏—Ä–∂–µ (–±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ä–∞–Ω–µ–µ)

**–î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞**:

1. **–í `position_manager.py`** (–¥–ª—è –ø–æ–∑–∏—Ü–∏–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ PositionManager):
   - Trailing stop –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - –°—Ä–∞–∑—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –±–∏—Ä–∂–µ–π —á–µ—Ä–µ–∑ Trading Stop API

2. **–í `stop_loss_tp_manager.py`** (–¥–ª—è ATR-based —É—Ä–æ–≤–Ω–µ–π):
   - `update_trailing_stop()` —É–∂–µ –≤—ã–∑—ã–≤–∞–ª `update_sl_tp()`
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –±–∏—Ä–∂–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º `use_exchange_sl_tp`

**–ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤**:
```
Trailing stop updated: BTCUSDT SL 44800.00 -> 45100.00
‚úì Trailing stop synced to exchange: BTCUSDT SL=45100.00
```

---

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ü–∏–∫–ª–æ–º –±–æ—Ç–∞

**–§–∞–π–ª**: `bot/trading_bot.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

1. **–í—ã–∑–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π** (—Å—Ç—Ä–æ–∫–∞ ~653):
```python
# –û–±–Ω–æ–≤–ª—è–µ–º position_manager –¥–ª—è breakeven/trailing/time_stop/partial_exits
if self.mode == "live" and self.position_manager:
    for symbol in self.position_manager.active_positions.keys():
        self.position_manager.update_position(symbol, current_price, current_size)
```

2. **–ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ–Ω—Ñ–∏–≥–∞** (—Å—Ç—Ä–æ–∫–∞ ~2054):
```python
self.position_manager.register_position(
    symbol=self.symbol,
    side=side,
    entry_price=float(normalized_price),
    size=float(normalized_qty),
    stop_loss=...,
    take_profit=...,
    breakeven_trigger=float(self.config.get("position_management.breakeven_trigger", 1.5)),
    trailing_offset_percent=float(self.config.get("position_management.trailing_offset_percent", 1.0)),
    time_stop_minutes=int(self.config.get("position_management.time_stop_minutes", 60)),
    partial_exit_levels=partial_exit_levels,  # –ò–∑ –∫–æ–Ω—Ñ–∏–≥–∞
)
```

---

## üìä –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –¢–ó 7.2 | –°—Ç–∞—Ç—É—Å –¥–æ | –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ |
|-------------------|-----------|--------------|
| –ü–µ—Ä–µ–≤–æ–¥ –≤ –±–µ–∑—É–±—ã—Ç–æ–∫ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –±–∏—Ä–∂–µ–π |
| **–ß–∞—Å—Ç–∏—á–Ω—ã–µ —Ç–µ–π–∫–∏ (scale-out)** | ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–ª–æ | ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–û** |
| –¢—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø | ‚ö†Ô∏è –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ | ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –±–∏—Ä–∂–µ–π** |
| –¢–∞–π–º-—Å—Ç–æ–ø | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

**–û–±—â–µ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó**: 95% ‚Üí **100%** ‚¨ÜÔ∏è

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞:
```bash
python -m py_compile bot/trading_bot.py execution/position_manager.py
# ‚úì Success
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞:
```bash
cat config.yaml | grep -A 15 "position_management"
# ‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏):

1. **Partial Exits**:
   - –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é –Ω–∞ testnet
   - –î–æ–∂–¥–∞—Ç—å—Å—è –¥–≤–∏–∂–µ–Ω–∏—è –≤ –ø—Ä–∏–±—ã–ª—å 2R
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ 50% –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `üéØ Partial exit triggered`

2. **Trailing Stop**:
   - –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏—é
   - –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –¥–≤–∏–∂–µ–Ω–∏–µ–º —Ü–µ–Ω—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: `‚úì Trailing stop synced to exchange`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Bybit UI —á—Ç–æ SL –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è

---

## üìù –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ partial exits:

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**:
```yaml
position_management:
  partial_exits:
    enabled: true
    levels:
      - r_level: 2.0
        percent: 0.50
      - r_level: 3.0
        percent: 0.25
```

**–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è (–±—ã—Å—Ç—Ä–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è)**:
```yaml
position_management:
  partial_exits:
    enabled: true
    levels:
      - r_level: 1.5
        percent: 0.33
      - r_level: 2.5
        percent: 0.33
      - r_level: 4.0
        percent: 0.34
```

**–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è (–¥–µ—Ä–∂–∞—Ç—å –¥–æ –∫–æ–Ω—Ü–∞)**:
```yaml
position_management:
  partial_exits:
    enabled: false  # –û—Ç–∫–ª—é—á–∏—Ç—å scale-out
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ trailing stop:

```yaml
position_management:
  trailing_offset_percent: 1.0  # 1% –æ—Ç—Å—Ç—É–ø (—á–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–µ–µ)
```

---

## üöÄ –ò—Ç–æ–≥–∏

‚úÖ **Partial Exits —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —É—Ä–æ–≤–Ω–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –≤—ã—Ö–æ–¥–∞

‚úÖ **Trailing Stop —Ç–µ–ø–µ—Ä—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –±–∏—Ä–∂–µ–π**
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Trading Stop API
- –ó–∞—â–∏—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- Fallback –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

‚úÖ **–ö–æ–¥ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω**
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤–∞–ª–∏–¥–µ–Ω
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ü–∏–∫–ª–æ–º

**–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¢–ó 7.2 –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ 100%!** üéâ
