# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ pandas rolling()

## –ü—Ä–æ–±–ª–µ–º–∞

Kill switch –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è –∏–∑-–∑–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ:
```
NDFrame.rolling() got an unexpected keyword argument '_window'
```

–≠—Ç–æ –±—ã–ª–∞ –Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
```sql
SELECT datetime(timestamp,'unixepoch','localtime') as ts,
       error_type,
       message
FROM errors
WHERE error_type IN ('kill_switch_activated','kill_switch_reset')
ORDER BY timestamp DESC
LIMIT 20;

ts                   error_type             message
-------------------  ---------------------  ------------------------------------------------
2026-02-08 06:41:28  kill_switch_activated  Critical error: NDFrame.rolling() got an unexpected keyword argument '_window'
```

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

–í —Ç—Ä–µ—Ö —Ñ–∞–π–ª–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä** `_window` –≤–º–µ—Å—Ç–æ `window` –¥–ª—è –º–µ—Ç–æ–¥–∞ pandas `.rolling()`:

### 1. data/indicators.py (—Å—Ç—Ä–æ–∫–∞ 310)
```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
vwap = (typical_price * df["volume"]).rolling(window=20).sum() / df["volume"].rolling(
    _window=20  # ‚Üê –û—à–∏–±–∫–∞!
).sum()
```

### 2. data/indicators_fallback.py (—Å—Ç—Ä–æ–∫–∞ 254)
```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
df["volume_zscore"] = (df["volume"] - df["volume_sma"]) / df["volume"].rolling(
    _window=period  # ‚Üê –û—à–∏–±–∫–∞!
).std()
```

### 3. data/indicators_new.py (—Å—Ç—Ä–æ–∫–∞ 302)
```python
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
vwap = (typical_price * df["volume"]).rolling(window=20).sum() / df["volume"].rolling(
    _window=20  # ‚Üê –û—à–∏–±–∫–∞!
).sum()
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:**
API pandas –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä `window`, –∞ –Ω–µ `_window`. –°–∏–º–≤–æ–ª –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –≤ –Ω–∞—á–∞–ª–µ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç/–ø–∞—Ä–∞–º–µ—Ç—Ä –≤ Python, –∏ pandas –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–∞–∫–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä.

## –†–µ—à–µ–Ω–∏–µ

–ó–∞–º–µ–Ω–µ–Ω–æ `_window=` –Ω–∞ `window=` –≤–æ –≤—Å–µ—Ö —Ç—Ä–µ—Ö —Ñ–∞–π–ª–∞—Ö:

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: data/indicators.py
```python
# –ü–†–ê–í–ò–õ–¨–ù–û:
vwap = (typical_price * df["volume"]).rolling(window=20).sum() / df["volume"].rolling(
    window=20  # ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
).sum()
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: data/indicators_fallback.py
```python
# –ü–†–ê–í–ò–õ–¨–ù–û:
df["volume_zscore"] = (df["volume"] - df["volume_sma"]) / df["volume"].rolling(
    window=period  # ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
).std()
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 3: data/indicators_new.py
```python
# –ü–†–ê–í–ò–õ–¨–ù–û:
vwap = (typical_price * df["volume"]).rolling(window=20).sum() / df["volume"].rolling(
    window=20  # ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
).sum()
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç `test_pandas_rolling_fix.py` –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:

1. **VWAP –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (indicators.py)** - —Ä–∞—Å—á–µ—Ç VWAP –∏ vwap_distance
2. **VWAP –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä (indicators_new.py)** - —Ä–∞—Å—á–µ—Ç VWAP –∏ vwap_distance
3. **Volume –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (indicators_fallback.py)** - —Ä–∞—Å—á–µ—Ç volume_sma –∏ volume_zscore

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤:
```
‚úÖ PASS - VWAP –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä (indicators.py)
‚úÖ PASS - VWAP –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä (indicators_new.py)
‚úÖ PASS - Volume –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã (indicators_fallback.py)

–ò—Ç–æ–≥–æ: 3/3 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ

üéâ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–®–õ–ò! –ë–∞–≥ —Å pandas rolling –∏—Å–ø—Ä–∞–≤–ª–µ–Ω.
```

## –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã

**–ò–∑–º–µ–Ω–µ–Ω–æ:**
- `data/indicators.py` - —Å—Ç—Ä–æ–∫–∞ 310: `_window=20` ‚Üí `window=20`
- `data/indicators_fallback.py` - —Å—Ç—Ä–æ–∫–∞ 254: `_window=period` ‚Üí `window=period`
- `data/indicators_new.py` - —Å—Ç—Ä–æ–∫–∞ 302: `_window=20` ‚Üí `window=20`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- `test_pandas_rolling_fix.py` - –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## –í–ª–∏—è–Ω–∏–µ

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞
- ‚ùå Kill switch –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª—Å—è
- ‚ùå –ë–æ—Ç –Ω–µ –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –í—Å–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ pandas
- ‚úÖ Kill switch –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã
- ‚úÖ –ë–æ—Ç –º–æ–∂–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å

## –í–∞–∂–Ω–æ

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –±—ã–ª–∞ **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π** –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –û–Ω–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
2. –ü—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ kill switch
3. –ë–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞ –¥–æ —Ä—É—á–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ kill switch

–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –Ω–µ –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ß—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
python test_pandas_rolling_fix.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ _window –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
grep -rn "_window=" data/indicators*.py
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: (–Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
```

## –°—Ç–∞—Ç—É—Å
‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û**

–ë–∞–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π pandas API –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.
